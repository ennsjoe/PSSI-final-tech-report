
### Project `r project$project_id`: `r project$project_title`

```{r, results='asis', echo=FALSE}
# Helper function to safely extract text from project data
safe_text <- function(value) {
  if (is.null(value) || is.na(value)) return(NULL)
  text <- as.character(value)
  if (nchar(text) > 0) return(text)
  return(NULL)
}

# Display project metadata
metadata_items <- c()

if (!is.null(safe_text(project$project_leads))) {
  metadata_items <- c(metadata_items, paste0("**Project Leads:** ", safe_text(project$project_leads)))
}

if (!is.null(safe_text(project$collaborations))) {
  metadata_items <- c(metadata_items, paste0("**Collaborations:** ", safe_text(project$collaborations)))
}

if (!is.null(safe_text(project$location))) {
  metadata_items <- c(metadata_items, paste0("**Location:** ", safe_text(project$location)))
}

if (!is.null(safe_text(project$region))) {
  metadata_items <- c(metadata_items, paste0("**Region:** ", safe_text(project$region)))
}

if (!is.null(safe_text(project$species))) {
  metadata_items <- c(metadata_items, paste0("**Species:** ", safe_text(project$species)))
}

if (!is.null(safe_text(project$waterbodies))) {
  metadata_items <- c(metadata_items, paste0("**Waterbodies:** ", safe_text(project$waterbodies)))
}

if (!is.null(safe_text(project$life_history))) {
  metadata_items <- c(metadata_items, paste0("**Life History:** ", safe_text(project$life_history)))
}

if (!is.null(safe_text(project$stock))) {
  metadata_items <- c(metadata_items, paste0("**Stock:** ", safe_text(project$stock)))
}

if (!is.null(safe_text(project$population))) {
  metadata_items <- c(metadata_items, paste0("**Population:** ", safe_text(project$population)))
}

if (!is.null(safe_text(project$cu))) {
  metadata_items <- c(metadata_items, paste0("**Conservation Unit:** ", safe_text(project$cu)))
}

if (length(metadata_items) > 0) {
  cat(paste(metadata_items, collapse = " \n\n "), "\n\n")
}

# Highlights section
highlights_text <- safe_text(project$highlights)
if (!is.null(highlights_text)) {
  cat("#### Highlights\n\n")
  cat(highlights_text, "\n\n")
}

# Background section
background_text <- safe_text(project$background)
if (!is.null(background_text)) {
  cat("#### Background\n\n")
  cat(background_text, "\n\n")
}

# Methods and Findings section
methods_text <- safe_text(project$methods_findings)
if (!is.null(methods_text)) {
  cat("#### Methods and Findings\n\n")
  cat(methods_text, "\n\n")
}

# Insights section
insights_text <- safe_text(project$insights)
if (!is.null(insights_text)) {
  cat("#### Insights\n\n")
  cat(insights_text, "\n\n")
}

# Next Steps section
next_steps_text <- safe_text(project$next_steps)
if (!is.null(next_steps_text)) {
  cat("#### Next Steps\n\n")
  cat(next_steps_text, "\n\n")
}

# References section
references_text <- safe_text(project$references)
if (!is.null(references_text)) {
  cat("#### References\n\n")
  
  # Split references by double line breaks
  refs <- strsplit(references_text, "\n\n")[[1]]
  refs <- trimws(refs)
  refs <- refs[refs != ""]
  
  # Display each reference
  for (ref in refs) {
    cat("::: {custom-style=\"Bibliography\"}\n")
    cat(ref, "\n")
    cat(":::\n\n")
  }
}
```

\newpage
