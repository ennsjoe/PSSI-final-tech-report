# APPENDIX A. Project Summary Table {#app:projects}

```{r appendix-a-setup, include=FALSE}

knitr::opts_chunk$set(
  tab.cap.pre    = "Table A-",
  tab.cap.sep    = ". ",
  tab.lp         = "tabA:",
  tab.topcaption = TRUE,
  fig.cap.pre    = "Figure A-",
  fig.cap.sep    = ". ",
  fig.lp         = "figA:"
)
```

```{r project-summary-table, tab.cap="Summary of all PSSI research projects.", tab.id="tbl-proj-summary"}

# projects_df is loaded in the global environment by _common.R via index.Rmd

if (!exists("projects_df") || is.null(projects_df) || nrow(projects_df) == 0) {

  cat("*No project data available. Ensure _common.R has been sourced.*\n")

} else {

  summary_df <- projects_df %>%
    filter(include %in% c("y", "Y")) %>%
    arrange(source, broad_header, section, project_id) %>%
    select(
      Source        = source,
      Theme         = broad_header,
      Section       = section,
      `Project ID`  = project_id,
      Title         = project_title
    ) %>%
    mutate(across(everything(), ~ ifelse(is.na(.x), "\u2014", as.character(.x))))

  ft <- flextable::flextable(summary_df) %>%
    flextable::merge_v(j = c("Source", "Theme", "Section")) %>%
    flextable::valign(valign = "top", part = "body") %>%
    flextable::align(align = "left", part = "all") %>%
    flextable::bold(part = "header") %>%
    flextable::fontsize(size = 8, part = "body") %>%
    flextable::fontsize(size = 9, part = "header") %>%
    flextable::bg(part = "header", bg = "#50B1BA") %>%
    flextable::color(part = "header", color = "white") %>%
    flextable::width(j = "Source",      width = 0.9) %>%
    flextable::width(j = "Theme",       width = 1.1) %>%
    flextable::width(j = "Section",     width = 1.5) %>%
    flextable::width(j = "Project ID",  width = 0.8) %>%
    flextable::width(j = "Title",       width = 2.1) %>%
    flextable::set_table_properties(layout = "fixed") %>%
    flextable::border_outer(
      part   = "all",
      border = officer::fp_border(color = "#BFBFBF", width = 1)
    ) %>%
    flextable::border_inner_h(
      part   = "all",
      border = officer::fp_border(color = "#E0E0E0", width = 0.75)
    ) %>%
    flextable::border_inner_v(
      part   = "all",
      border = officer::fp_border(color = "#E0E0E0", width = 0.75)
    )

  ft
}
```

`r officer::run_pagebreak()`
